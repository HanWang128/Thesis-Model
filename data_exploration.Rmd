---
title: "Data Exploration"
---
```{r, include=FALSE}
library(psych)
library(corrplot)
library(dplyr)
library(tidyverse)
library(stringr)
library(base)
library(sf)
library(scales)
library(vars)
library(lattice)
library(urca)
library(ggplot2)
library(MASS)
library(haven)
library(joineR)
library(pROC)
library(MESS)
library(arules)
library(fpp2)
```

# read file
```{r}
data=read.csv('new_data.csv')
```

# Data exploration
```{r}
describe(data)
```

There are 12 variables in the data with 485 observations. Including 1 date variable, 2 response variables, and 9 predictors. All variables are numeric type except variable 'date'. 
1. date
2. new_cases: the daily new confirmed COVID cases in Netherlands
3. new_deaths: the daily new deaths of COVID patients in Netherlands
4. ICU_patients: the COVID patients admitted to ICU per day in hospital
5. Hosp_patients: the COVID patients admitted to hospital per day
6. stringency_index:
7. temp: daily temperature
8. humidity: daily humidity
9. precipitation: the amount of rains per day
10. winds peed: daily winds peed
11. transit_stations:  number of visitors to transit stations has changed compared to baseline days (baseline: median value for the 5â€‘week period from January 3 to February 6, 2020)
12: residential: change in duration of time spent at home. People already spend a lot of time at home, so changes in Residential are likely to be smaller.





## checking missingness
```{r}
sum(is.na(data))
sum(is.na(data$icu_patients))
sum(is.na(data$hosp_patients))
```
There are 18 missing values in the data, locate in ICU patients and Hospital patients columns. (The government website does not have COVID records for some days during 2021- 2022)

## correlations 
```{r}
# remove the missing values

pairs(na.omit(data[, 2:6]))

cor(na.omit(data[, 2:12]))

corrplot(cor(na.omit(data[, 2:12])), method = "circle",
        title = "method = 'circle'") 
```
After removing the missing values, we plot the correlation graph
For hospital admission
1.hospital admission and humidity,hospital admission and wind speed, hospital admission and precipitation have small correlation less than 0.1
2.hospital admission and new deaths, hospital admission and resident are highly positive correlated 
3.hospital admission and temperature, hospital admission and transit are highly negative correlated

for hospital admission: fit var model including all variables, comparing to the var model without humidity, precipitation, and wind speed.



For ICU admission
1.ICU admission and humidity, ICU admission and precipitation, ICU and wind speed have small correlation less than 0.1.
2.ICU admission and new deaths, ICU admission and stringency, ICU admission and resident are highly positive correlated 
3.ICU admission and temperature, ICU admission and transit are highly negative correlated

for ICU admission: fit var model including all variables, comparing to the var model without humidity, precipitation and wind speed.


new deaths highly positive correlated to stringency_index, and residential. Negative correlated to temperature and public transition.

strigency_index increases, residential increases, transition decreases. (temperature has opposite relation)

transit and residential as highly negative correlated.

Since the data contains missing value, we will use interpolation methods to replace the NA values.


# Plots
```{r}
par(mfrow=c(2,2))
plot(data$new_cases) 
# 2022-02-07 has 380399 cases, (outlier, remove and graph again) volatity
# 2022-01-17 and 2022-02-22 have 0 and 2 new cases, we treat them as outliers. 
# 2021-09-11 has 22 new cases, previous day and day after have over 2800 cases, treat it as outliers.

plot(data$new_deaths)
boxplot(data$new_deaths)
# more deaths at the beginning 

plot(data$icu_patients)
boxplot(data$icu_patients) # no outliers
plot(data$hosp_patients)
boxplot(data$hosp_patients) #no outliers

plot(data$stringency_index) 
plot(data$temp)
plot(data$humidity)
plot(data$precip)
plot(data$windspeed)
plot(data$transit_stations)
plot(data$residential)
# ICU, hosp, stringency, residential trends are similar, transition has opposite trend.


```

for the outliers in new cases variable, we replace it using na.interp()
```{r}
data$new_cases=ifelse(data$new_cases<50, NA,ifelse(data$new_cases>300000, NA, data$new_cases))

data$new_cases=na.interp(data$new_cases)
data$icu_patients=na.interp(data$icu_patients)
data$hosp_patients=na.interp(data$hosp_patients)

sum(is.na(data))
```

```{r}
write.csv(data, 'data_daily_generate.csv',row.names = FALSE)
```


# aggregating daily data into weekly data
```{r}
week_data=function(df){
   data$week=week(data$date)
   data %>% group_by(week)%>% summarize(newcases = mean(new_cases), newdeaths=mean(new_deaths),    
            icu=mean(icu_patients), 
            hospital=mean(hosp_patients),
            stringency=mean(stringency_index),
            temperature=mean(temp),
            humidity=mean(humidity),
            precipitation=mean(precip),
            windspeed=mean(windspeed),
            transit=mean(transit_stations),
            resident=mean(residential)
            )
  return(table)
  #print(table)
}

weekdata=week_data(data)
#group_by(table$week)%>%summarize(newcases = mean(table$new_cases))

#data1<- as.xts(data$new_cases,order.by=as.Date(data$date))
#weekly <- apply.weekly(data,sum)
```

```{r}
write.csv(week_data, 'data_weekly_generate.csv',row.names = FALSE)
```
